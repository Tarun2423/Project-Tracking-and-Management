<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manager</title>
  <link rel="stylesheet" href="mhome.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link href="https://fonts.googleapis.com/css2?family=Protest+Riot&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
</head>

<body>
  <div class="app">
    <div class="nav">
      <div class="title">
        <p>Project Management</p>
      </div>
      <div class="links">
        <p id="emp" class="selected" onclick="employees()">Team Members</p>
        <p id="tasks" onclick="tasks()">Tasks</p>
        <p id="reports" onclick="reports()">Reports</p>
        <p id="charts" onclick="charts()">Charts</p>
        <p id="pro" onclick="profile()">Profile</p>
      </div>
      <div class="profile">
        <img src="userpic.jpg" alt="">
        <p id="name" onclick="toggle()"></p>
        <p id="logout" onclick="logout()">Logout</p>
      </div>
    </div>
    <div class="Home" id="Home">
      <div class="Employees" id="Employees">
        <div class="top">
          <div class="search">
            <input type="text" placeholder="Enter text to search" oninput="search()" id="inp">
            <span style="cursor: pointer;" class="material-symbols-outlined">
              search
            </span>
          </div>

        </div>
        <div class="table">
          <div class="heading">
            <p style="width: 10%;">EmpId</p>
            <p style="width: 15%;">Name</p>
            <p style="width: 25%;">Email Id</p>
            <p style="width: 10%;">Role</p>
            <p style="width: 10%;">DOB</p>
            <p style="width: 10%;">Mobile</p>
            <p style="width: 20%;">Reporting Manager</p>
          </div>
          <hr style="color: black;width: 100%;" />
          <div class="tableContent" id="tableContent">


          </div>
        </div>
      </div>
      <div class="Projects" id="Projects">
        <button class="btn" id="abtn" style="position: absolute;top: 100px;right: 190px;" onclick="atask()">Assigned Tasks</button>
        <button class="btn" id="cbtn" style="position: absolute;top: 100px;right: 190px;" onclick="ctask()">Create Tasks</button>
        <div class="tcontainer" id="tcontainer">
          <div class="item">
            <p>Project Name</p>
            <select name="project" id="project" required>
              <option value="" disabled selected hidden>Select an option below</option>
            </select>
          </div>
          <div class="item">
            <p>Employee Name</p>
            <select name="toemp" id="toempl" required>
              <option value="" disabled selected hidden>Select an option below</option>
            </select>
          </div>
          <div class="item">
            <p>Task Name</p>
            <input type="text" id="taskname">
          </div>
          <div class="item">
            <p>Details</p>
            <input type="text" id="taskdetails">
          </div>
          <div class="item">
            <p>Deadline</p>
            <input type="date" name="taskdeadline" id="taskdeadline">
          </div>
          <button onclick="addTask()">CREATE</button>
        </div>
        <div class="tasktable" id="tasktable">

          <div class="top">
            <div class="search">
              <input type="text" placeholder="Enter text to search" oninput="searchT()" id="tinp">
              <span style="cursor: pointer;" class="material-symbols-outlined">
                search
              </span>
            </div>
          </div>
          <div class="table">
            <div class="heading">
              <p style="width: 8%;">Task Id</p>
              <p style="width: 22%;">Task Name</p>
              <p style="width: 15%;">Assigned To</p>
              <p style="width: 15%;">Assigned on</p>
              <p style="width: 15%;">Deadline</p>
              <p style="width: 10%;">Status</p>
              <p style="width: 15%;">Update Status</p>
            </div>
            <hr style="color: black;width: 100%;" />
            <div class="tableContent" id="ttableContent">
            </div>
          </div>

        </div>
      </div>
      <div class="Reports" id="Reports">
        <div class="top">
          <div class="search">
            <input type="text" placeholder="Enter text to search" oninput="searchR()" id="inp">
            <span style="cursor: pointer;" class="material-symbols-outlined">
              search
            </span>
          </div>
        </div>
        <div class="table">
          <div class="heading">
            <p style="width: 10%;">Report Id</p>
            <p style="width: 25%;">Task Name</p>
            <p style="width: 25%;">From</p>
            <p style="width: 25%;">Report</p>
            <p style="width: 15%;">Time</p>
          </div>
          <hr style="color: black;width: 100%;" />
          <div class="tableContent" id="RtableContent">


          </div>
        </div>
      </div>
      <div class="P" id="P">
        <div class="Profile" id="profileContainer">
          <div class="Pimg">
            <img id="displayedMImage" alt="Displayed Image" src="">
          </div>

          <div class="pout">
            <div class="pdetails">
              <div class="profileField">
                <label for="employeeId" class="label">Employee Id:</label>
                <input type="text" id="midInput" class="input" value="24" disabled>
              </div>
              <div class="profileField">
                <label for="nameInput" class="label">Name:</label>
                <input type="text" id="mnameInput" class="input" value="Tarun" disabled>
              </div>
              <div class="profileField">
                <label for="emailInput" class="label">Email Id:</label>
                <input type="text" id="memailInput" class="input" value="Tarun@gmail.com" disabled>
              </div>
              <div class="profileField">
                <label for="dobInput" class="label">Date Of Birth:</label>
                <input type="text" id="mdobInput" class="input" value="24-05-2002" disabled>
              </div>
              <div class="profileField">
                <label for="roleInput" class="label">Role:</label>
                <input type="text" id="mroleInput" class="input" value="Developer" disabled>
              </div>
              <div class="profileField">
                <label for="dojInput" class="label">Date Of Joining:</label>
                <input type="text" id="mdojInput" class="input" value="01-01-2023" disabled>
              </div>
              <div class="profileField">
                <label for="mobileInput" class="label">Mobile Number:</label>
                <input type="text" id="mmobileInput" class="input" value="9360623104" disabled>
              </div>
            </div>

          </div>
        </div>
      </div>

      <div class="Charts" id="ChartsCon">
        <div class="text" id="text">
          <p>Choose project to show Data</p>
        </div>
        <div class="proname">
          <p>Employee Name :</p>
          <select name="pronames" id="pronames">
            <option value="" disabled selected hidden>Select an option below</option>
          </select>
          <button class="btn1" onclick="fetch()">Fetch</button>
        </div>
        <div class="Bar">
          <div class="progress-bar" id="bar">
            <div class="progress"></div>
          </div>
        </div>
        <div class="bardetails" id="bardetails">
          <div class="tt">
            <p>Total No. Of Tasks : </p>
            <p id="totaltask"></p>
          </div>
          <div class="tf">
            <p>No. Of Tasks Finished : </p>
            <p id="finished"></p>
          </div>

        </div>
      </div>

    </div>
  </div>
  <script>
     function fetch() {

var pname = document.getElementById("pronames").value;
console.log(pname);
if (pname !== "") {

  var xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function() {
    if (xhr.readyState == 4 && xhr.status == 200) {

      var data = (JSON.parse(xhr.responseText));
      var total = data[0].nooftasks;
      var finished = data[0].finished;
      var unfinished = data[0].unfinished;
      document.getElementById("totaltask").textContent = total;
      document.getElementById("finished").textContent = finished;
      document.getElementById("text").style.display = "none";
      document.getElementById("bar").style.display = "";
      document.getElementById("bardetails").style.display = "";
      var fp = Math.ceil((finished / total) * 100)
      const progressBar = document.querySelector('.progress');
      const percentageCompleted = fp;
      progressBar.style.height = percentageCompleted + '%';
      progressBar.textContent = percentageCompleted + '%';
    }
  }
  xhr.open("GET", "http://localhost:5678/ProjectManagement/getEDetails?pname=" + pname, true);
  xhr.send();
}
}

function charts() {
  document.getElementById("ChartsCon").style.display = "flex";
      document.getElementById("Employees").style.display = "none";
      document.getElementById("P").style.display = "none";
      document.getElementById("Projects").style.display = "none";
      document.getElementById("Reports").style.display = "none";
      document.getElementById("pro").classList.remove("selected");
      document.getElementById("charts").classList.add("selected");
      document.getElementById("emp").classList.remove("selected");
      document.getElementById("tasks").classList.remove("selected");
      document.getElementById("reports").classList.remove("selected");
}
    function profile() {
      document.getElementById("P").style.display = "flex";
      document.getElementById("Employees").style.display = "none";
      document.getElementById("Projects").style.display = "none";
      document.getElementById("Reports").style.display = "none";
      document.getElementById("ChartsCon").style.display = "none";
      document.getElementById("pro").classList.add("selected");
      document.getElementById("emp").classList.remove("selected");
      document.getElementById("charts").classList.remove("selected");
      document.getElementById("tasks").classList.remove("selected");
      document.getElementById("reports").classList.remove("selected");
    }

    function ctask() {
      document.getElementById("tcontainer").style.display = "";
      document.getElementById("tasktable").style.display = "none";
      document.getElementById("cbtn").style.display = "none";
      document.getElementById("abtn").style.display = "";
    }

    function atask() {
      document.getElementById("tcontainer").style.display = "none";
      document.getElementById("tasktable").style.display = "";
      document.getElementById("abtn").style.display = "none";
      document.getElementById("cbtn").style.display = "";
      getTasks()
    }

    function showApiResultModal(message, isSuccess) {
      return new Promise((resolve) => {
        if (isSuccess) {
          Swal.fire({
            title: "Success",
            text: message,
            icon: "success",
          }).then(() => {
            resolve();
            window.location.reload();
          });
        } else {
          Swal.fire({
            title: "Failure",
            text: message,
            icon: "error",
          }).then(() => {
            resolve();
          });
        }
      });
    }

    function addTask() {
      var pname = document.getElementById("project").value;
      var toemp = document.getElementById("toemp").value;
      var taskname = document.getElementById("taskname").value;
      var taskdetails = document.getElementById("taskdetails").value;
      var taskdeadline = document.getElementById("taskdeadline").value;
      if (pname !== "" && taskname !== "" && taskdetails !== "" && taskdeadline !== "" && toemp !== "") {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
          if (xhttp.readyState == 4 && xhttp.status == 200) {
            showApiResultModal("Task successfully created", true);
          } else if (xhttp.readyState == 4 && xhttp.status !== 200) {
            searchApiResultModal("Task creation failed", false);
          }
        }
        xhttp.open("POST", "http://localhost:5678/ProjectManagement/addTask", true);
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        var data = "pname=" + pname + "&details=" + taskdetails + "&deadline=" + taskdeadline + "&tname=" + taskname + "&ename=" + toemp + "&manager=" + JSON.parse(window.localStorage.getItem("user")).name;
        xhttp.send(data);
      } else {
        alert("fill all details")
      }
    }

    function handleAddP() {
      window.location.href = "http://localhost:5678/ProjectManagement/Project.html"
    }

    function tasks() {
      document.getElementById("emp").classList.remove("selected");
      document.getElementById("pro").classList.remove("selected");
      document.getElementById("charts").classList.remove("selected");
      document.getElementById("reports").classList.remove("selected");
      document.getElementById("tasks").classList.add("selected");
      document.getElementById("Employees").style.display = "none";
      document.getElementById("Reports").style.display = "none";
      document.getElementById("ChartsCon").style.display = "none";
      document.getElementById("P").style.display = "none";
      document.getElementById("Projects").style.display = "";
      getTasks();
    }

    function employees() {
      document.getElementById("emp").classList.add("selected");
      document.getElementById("pro").classList.remove("selected");
      document.getElementById("charts").classList.remove("selected");
      document.getElementById("reports").classList.remove("selected");
      document.getElementById("tasks").classList.remove("selected");
      document.getElementById("Reports").style.display = "none";
      document.getElementById("ChartsCon").style.display = "none";
      document.getElementById("Employees").style.display = "";
      document.getElementById("Projects").style.display = "none";
      document.getElementById("P").style.display = "none";
    }

    function reports() {
      document.getElementById("reports").classList.add("selected");
      document.getElementById("pro").classList.remove("selected");
      document.getElementById("charts").classList.remove("selected");
      document.getElementById("tasks").classList.remove("selected");
      document.getElementById("emp").classList.remove("selected");
      document.getElementById("ChartsCon").style.display = "none";
      document.getElementById("Employees").style.display = "none";
      document.getElementById("Reports").style.display = "";
      document.getElementById("Projects").style.display = "none";
      document.getElementById("P").style.display = "none";
      getReports();
    }

    function logout() {

      window.location.href = "http://localhost:5678/ProjectManagement/Login.html"
    }
    document.getElementById("Home").addEventListener("click", function() {
      retoggle();
    })

    function toggle() {
      document.getElementById("logout").style.display = "";
      document.getElementById("name").style.display = "none";
    }

    function retoggle() {
      document.getElementById("logout").style.display = "none";
      document.getElementById("name").style.display = "";
    }

    function handleAdd() {
      window.location.href = ("http://localhost:5678/ProjectManagement/Register.html")
    }
    window.onload = function() {
      var user = JSON.parse(window.localStorage.getItem("user"));
      var byteArray = new Uint8Array(user.image);
      var imageUrl = 'data:image/jpeg;base64,' + btoa(String.fromCharCode.apply(null, byteArray));
      document.getElementById("displayedMImage").src = imageUrl;
      document.getElementById("name").innerHTML = user.name;
      document.getElementById("logout").style.display = "none";
      document.getElementById("Projects").style.display = "none";
      document.getElementById("Reports").style.display = "none";
      document.getElementById("tcontainer").style.display = "none";
      document.getElementById("ChartsCon").style.display = "none";
      document.getElementById("P").style.display = "none";
      document.getElementById("abtn").style.display = "none";
      document.getElementById("name").style.display = "";
      document.getElementById("bar").style.display = "none";
      document.getElementById("bardetails").style.display = "none";
      document.getElementById("text").style.display = "";
      document.getElementById("midInput").value = user.empid;
      document.getElementById("mnameInput").value = user.name;
      document.getElementById("memailInput").value = user.email;
      document.getElementById("mdobInput").value = user.dob;
      document.getElementById("mroleInput").value = user.role;
      document.getElementById("mdojInput").value = user.joining;
      document.getElementById("mmobileInput").value = user.phone;
      var xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
          var data = JSON.parse(xhr.responseText);

          var table = document.getElementById("tableContent");
          table.innerHTML = "";
          var op = document.getElementById("toempl");
          op.innerHTML = "";
          op.innerHTML = `<option value="" disabled selected hidden>Select an option below</option>`;
          var op1 = document.getElementById("pronames");
          op1.innerHTML = "";
          op1.innerHTML = `<option value="" disabled selected hidden>Select an option below</option>`;
          data.forEach(function(i) {
            var ele = document.createElement("div");
            ele.classList.add("content");
            ele.innerHTML = `
                        <p id="sno" style="width: 10%;">${i.empid}</p>
                        <p id="pname" style="width: 15%;">${i.name}</p>
                        <p id="pem" style="width: 25%;">${i.email}</p>
                        <p id="prole" style="width: 10%;">${i.role}</p>
                        <p id="pdob" style="width: 10%;">${i.dob}</p>
                        <p id="pno" style="width: 10%;">${i.phone}</p>
                        <p id="pman" style="width: 20%;">${i.reportingto}</p>
                        
                        `;
            table.appendChild(ele);
            var el = document.createElement("option");
            el.textContent = i.name;
            el.value = i.name;
            op.appendChild(el);
            op1.appendChild(el);
          })
        }
      }
      xhr.open("POST", "http://localhost:5678/ProjectManagement/getEmployees", true);
      var data = "user=" + user.name;
      xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      xhr.send(data);




      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200 && this.responseText.trim() !== "Incorrect") {
          var data = JSON.parse(this.responseText);

          var table = document.getElementById("project");
          data.forEach(function(i) {
            var ele = document.createElement("option");
            ele.textContent = i.name;
            ele.value = i.name;
            table.appendChild(ele);

          })
        } else if (this.readyState == 4) {
          console.log(this.responseText);
        }
      }
      xhttp.open("GET", "http://localhost:5678/ProjectManagement/getproject", true);
      xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      xhttp.send();

      function getTasks() {
        var xhrt = new XMLHttpRequest();
        xhrt.onreadystatechange = function() {
          if (xhrt.readyState == 4 && xhrt.status == 200) {
            var data = JSON.parse(xhrt.responseText);
            console.log("dadad", data)
            var table = document.getElementById("ttableContent");
            data.forEach(function(i) {
              var ele = document.createElement("div");
              ele.classList.add("tcontent");

              var buttonHTML = ''; // Initialize an empty string for the button HTML
              if (i.status === "Completed") {
                buttonHTML = `<button class="disabled" style="width: 15%;color:black;background-color:rgb(238, 243, 243);height:25px;border-radius:10px;border:none;outline:none" disabled>Marked</button>`;

              } else {
                buttonHTML = `<button class="update" style="width: 15%;cursor:pointer;color:white;background-color:rgb(124, 232, 75);height:25px;border-radius:10px;border:none;outline:none" onclick="updateStatus('${i.id}')">Mark as Completed</button>`;

              }

              ele.innerHTML = `
        <p id="sno" style="width: 5%;">${i.id}</p>
        <p id="pname" style="width: 25%;">${i.tname}</p>
        <p id="pem" style="width: 15%;">${i.ename}</p>
        <p id="pem" style="width: 15%;">${i.assignedon}</p>
        <p id="prole" style="width: 15%;">${i.deadline}</p>
        <p id="pdob" style="width: 10%;cursor:pointer;">${i.status}</p>
        ${buttonHTML}
    `;

              table.appendChild(ele);
            });

          }
        }
        xhrt.open("GET", "http://localhost:5678/ProjectManagement/getTasks?manager=" + user.name, true);
        xhrt.send();
      }
      getTasks();

      function getReports() {

        var xhrr = new XMLHttpRequest();
        xhrr.onreadystatechange = function() {
          if (xhrr.readyState == 4 && xhrr.status == 200) {
            var data = JSON.parse(xhrr.responseText);
            console.log("sss", data)
            var table = document.getElementById("RtableContent");
            table.innerHTML = "";
            data.forEach(function(i) {
              var ele = document.createElement("div");
              ele.classList.add("content");
              ele.innerHTML = `
                        <p id="sno" style="width: 10%;">${i.id}</p>
                        <p id="pname" style="width: 25%;">${i.tname}</p>
                        <p id="pem" style="width: 25%;">${i.from}</p>
                        <p id="prole" style="width: 25%;">${i.report}</p>
                        <p id="pdob" style="width: 15%;">${i.time}</p>
        
                        
                        `;
              table.appendChild(ele);

            })
          }
        }
        xhrr.open("GET", "http://localhost:5678/ProjectManagement/getReport?manager=" + user.name, true);
        xhrr.send();
      }
      getReports();
    }

    function getReports() {
      var user = JSON.parse(window.localStorage.getItem("user"));
      var xhrr = new XMLHttpRequest();
      xhrr.onreadystatechange = function() {
        if (xhrr.readyState == 4 && xhrr.status == 200) {
          var data = JSON.parse(xhrr.responseText);
          console.log("sss", data)
          var table = document.getElementById("RtableContent");
          table.innerHTML = "";
          data.forEach(function(i) {
            var ele = document.createElement("div");
            ele.classList.add("content");
            ele.innerHTML = `
                          <p id="sno" style="width: 10%;">${i.id}</p>
                          <p id="pname" style="width: 25%;">${i.tname}</p>
                          <p id="pem" style="width: 25%;">${i.from}</p>
                          <p id="prole" style="width: 25%;">${i.report}</p>
                          <p id="pdob" style="width: 15%;">${i.time}</p>
          
                          
                          `;
            table.appendChild(ele);

          })
        }
      }
      xhrr.open("GET", "http://localhost:5678/ProjectManagement/getReport?manager=" + user.name, true);
      xhrr.send();
    }

    function getTasks() {
      var user = JSON.parse(window.localStorage.getItem("user"));
      var xhrt = new XMLHttpRequest();
      xhrt.onreadystatechange = function() {
        if (xhrt.readyState == 4 && xhrt.status == 200) {
          var data = JSON.parse(xhrt.responseText);
          console.log(data)
          var table = document.getElementById("ttableContent");
          data.forEach(function(i) {
            var ele = document.createElement("div");
            ele.classList.add("tcontent");

            var buttonHTML = ''; // Initialize an empty string for the button HTML
            if (i.status === "Completed") {
              buttonHTML = `<button class="disabled" style="width: 15%;color:black;background-color:rgb(238, 243, 243);height:25px;border-radius:10px;border:none;outline:none" disabled>Marked</button>`;

            } else {
              buttonHTML = `<button class="update" style="width: 15%;cursor:pointer;color:white;background-color:rgb(124, 232, 75);height:25px;border-radius:10px;border:none;outline:none" onclick="updateStatus('${i.id}')">Mark as Completed</button>`;

            }
            ele.innerHTML = `
        <p id="sno" style="width: 5%;">${i.id}</p>
        <p id="pname" style="width: 25%;">${i.tname}</p>
        <p id="pem" style="width: 15%;">${i.ename}</p>
        <p id="pem" style="width: 15%;">${i.assignedon}</p>
        <p id="prole" style="width: 15%;">${i.deadline}</p>
        <p id="pdob" style="width: 10%;cursor:pointer;">${i.status}</p>
        ${buttonHTML}
    `;

            table.appendChild(ele);
          });

        }
      }
      xhrt.open("GET", "http://localhost:5678/ProjectManagement/getTasks?manager=" + user.name, true);

      xhrt.send();
    }

    function updateStatus(iJson) {
      var xhrt = new XMLHttpRequest();
      xhrt.onreadystatechange = function() {
        if (xhrt.readyState == 4 && xhrt.status == 200 && xhrt.responseText.trim() == "success") {
          showApiResultModal("Successfully updated", true);
        } else if (xhrt.readyState == 4 && xhrt.status == 200 && xhrt.responseText.trim() !== "success") {
          showApiResultModal("Failed to update", false);
        }
      }

      xhrt.open("POST", "http://localhost:5678/ProjectManagement/updateStatus", true);
      xhrt.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
      var data = "id=" + iJson;
      xhrt.send(data);

    }

    function search() {
      var contents = document.querySelectorAll(".content");
      var filter = document.getElementById("inp").value;

      for (var i = 0; i < contents.length; i++) {
        var res = contents[i].textContent.trim().toUpperCase();
        filter = filter.toUpperCase();
        if (res.includes(filter)) {
          contents[i].style.display = "";
        } else {
          contents[i].style.display = "none";
        }

      }
    }

    function searchP() {
      var contents = document.querySelectorAll(".pcontent");
      var filter = document.getElementById("pinp").value;

      for (var i = 0; i < contents.length; i++) {
        var res = contents[i].textContent.trim().toUpperCase();
        filter = filter.toUpperCase();
        if (res.includes(filter)) {
          contents[i].style.display = "";
        } else {
          contents[i].style.display = "none";
        }

      }
    }

    function searchT() {
      var contents = document.querySelectorAll(".tcontent");
      var filter = document.getElementById("tinp").value;

      for (var i = 0; i < contents.length; i++) {
        var res = contents[i].textContent.trim().toUpperCase();
        filter = filter.toUpperCase();
        if (res.includes(filter)) {
          contents[i].style.display = "";
        } else {
          contents[i].style.display = "none";
        }

      }
    }
  </script>
</body>

</html>